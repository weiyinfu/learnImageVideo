import numpy as np
import pylab as plt
import sympy as sp
from sympy import atan2, sqrt

x1, x2, y1, y2, y1_, y2_ = sp.symbols("x1 x2 y1 y2 y1_ y2_")
ans = [(sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (-y1 ** 2 * y2_ ** 2 + y1_ ** 2 * y2 ** 2) / (y1_ ** 2 - y2_ ** 2), sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (-y1 ** 2 * y2_ ** 2 + y1_ ** 2 * y2 ** 2) / (y1 ** 2 - y2 ** 2),
        -x1 * sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (-y1 ** 2 * y2_ ** 2 + y1_ ** 2 * y2 ** 2) / (y1 ** 2 - y2 ** 2) + atan2(y1 * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)), -y1_ * sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2))),
        -x2 * sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (-y1 ** 2 * y2_ ** 2 + y1_ ** 2 * y2 ** 2) / (y1 ** 2 - y2 ** 2) + atan2(y2 * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)), -y2_ * sqrt((y1 - y2) * (y1 + y2) / ((y1 * y2_ - y1_ * y2) * (y1 * y2_ + y1_ * y2))))), (
           sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (-y1 ** 2 * y2_ ** 2 + y1_ ** 2 * y2 ** 2) / (y1_ ** 2 - y2_ ** 2), sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2) / (y1 ** 2 - y2 ** 2),
           -x1 * sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2) / (y1 ** 2 - y2 ** 2) + atan2(y1 * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)), y1_ * sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2))),
           -x2 * sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2) / (y1 ** 2 - y2 ** 2) + atan2(y2 * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)), y2_ * sqrt((y1 - y2) * (y1 + y2) / ((y1 * y2_ - y1_ * y2) * (y1 * y2_ + y1_ * y2))))), (
           sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2) / (y1_ ** 2 - y2_ ** 2), sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (-y1 ** 2 * y2_ ** 2 + y1_ ** 2 * y2 ** 2) / (y1 ** 2 - y2 ** 2),
           -x1 * sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (-y1 ** 2 * y2_ ** 2 + y1_ ** 2 * y2 ** 2) / (y1 ** 2 - y2 ** 2) + atan2(-y1 * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)), y1_ * sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2))),
           -x2 * sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (-y1 ** 2 * y2_ ** 2 + y1_ ** 2 * y2 ** 2) / (y1 ** 2 - y2 ** 2) + atan2(-y2 * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)), y2_ * sqrt((y1 - y2) * (y1 + y2) / ((y1 * y2_ - y1_ * y2) * (y1 * y2_ + y1_ * y2))))), (
           sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2) / (y1_ ** 2 - y2_ ** 2), sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2) / (y1 ** 2 - y2 ** 2),
           -x1 * sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2) / (y1 ** 2 - y2 ** 2) + atan2(-y1 * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)), -y1_ * sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2))),
           -x2 * sqrt((y1 ** 2 - y2 ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)) * (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2) / (y1 ** 2 - y2 ** 2) + atan2(-y2 * sqrt((-y1_ ** 2 + y2_ ** 2) / (y1 ** 2 * y2_ ** 2 - y1_ ** 2 * y2 ** 2)), -y2_ * sqrt((y1 - y2) * (y1 + y2) / ((y1 * y2_ - y1_ * y2) * (y1 * y2_ + y1_ * y2)))))]


def solve(X1, X2, Y1, Y2, Y1_, Y2_, ind):
    # 使用第ind组解法求解正弦函数
    ma = {x1: X1, x2: X2, y1: Y1, y2: Y2, y1_: Y1_, y2_: Y2_}
    res = [complex(v.evalf(subs=ma)) for v in (ans[ind])]
    res = np.array(res)
    return res


def main():
    np.random.seed(1234)
    AA, ww, phiphi = 2, 1.5, 1
    xx = np.linspace(2 * np.pi / ww, np.pi / ww, 100)
    yy = AA * np.sin(ww * xx + phiphi)
    i, j = np.random.choice(np.arange(3, len(xx) - 3), 2)
    if i > j:
        i, j = j, i
    X1, X2, Y1, Y2, Y1_, Y2_ = xx[i], xx[j], yy[i], yy[j], (yy[i] - yy[i - 1]) / (xx[i] - xx[i - 1]), (yy[j + 1] - yy[j]) / (xx[j + 1] - xx[j])
    print('计算斜率', Y1_, Y2_, AA * ww * np.cos(ww * np.array([xx[i], xx[j]]) + phiphi))
    print(f"真实答案 A={AA} w={ww} phi={phiphi}")

    for k in range(len(ans)):
        A, w, phi1, phi2 = solve(X1, X2, Y1, Y2, Y1_, Y2_, k)
        print(f"第{k}组答案:A={A},w={w},phi={phi1, phi2}")
        y = A * np.sin(w * xx + phi1)
        plt.plot(xx, y, label=f'{k}')
        plt.vlines([xx[i], xx[j]], np.min(y), np.max(y))
    plt.plot(xx, yy, label='real')
    plt.legend()
    plt.show()


main()
